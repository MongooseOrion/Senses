# 高阶有源 RC 低通滤波器的一些设计讨论
*该文档已归档 [利用开源框架的数字信号处理应用实例](https://github.com/MongooseOrion/Senses#%E5%88%A9%E7%94%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6%E7%9A%84%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B)*

滤波器是一种选频装置，可以使信号中特定的频率成分通过，而极大地衰减其他频率成分。利用滤波器的这种选频作用，可以滤除干扰噪声或进行频谱分析。传统的滤波器只有滤波的功能，而当今的滤波器，特别是音频领域内的大部分滤波器，是既有滤波的基础功能，同时又兼有信号放大的能力。

在信号领域内，滤波器分为无源滤波器和有源滤波器。有源滤波器是由集成运放和 RC 网络构成，由于集成运放的增益和输入阻抗都很高，且输出阻抗又很低，因此，有源滤波器还兼有放大信号的作用。

## 主要议题
  * 无源滤波器和有源滤波器各自的特点
  * 基于对 LC 梯形网络工作模拟的有源 RC 滤波器的设计法
  * 具有全极点的高阶有源 RC 低通滤波器设计
  * 具有有限传输零点的高阶有源 RC 低通滤波器设计

## 无源滤波器和有源滤波器各自的特点
### 无源滤波器
无源滤波器又称 LC 滤波器，是利用**电感、电容和电阻**的组合设计构成的滤波电路，可滤除某一次或多次谐波，最普通易于采用的无源滤波器结构是将电感与电容串联，可对主要次谐波构成低阻旁路。其主要优点是结构简单，成本低廉，运行可靠性高，运行费用较低。缺点是通带内的信号有能量损耗，负载效应比较明显，使用电感元件时容易引起电磁感应，当电感L较大时，滤波器的体积和重量都比较大，在低频段范围不适用。

### 有源滤波器
有源滤波器的频率范围是由直流到 500kHz，在低频范围内已取代了传统的 LC 滤波器，其主要特点为：
  1. 有源滤波器的输入阻抗高，输出阻抗极低，因而具有良好的隔离性能，所以各级之间均无阻抗匹配要求；
  2. 易于制作截止频率或中心频率连续可调的滤波器且调整容易；
  3. 如果使用电位器、可变电容器，有源滤波器的频率精度易于达到 0.5%；
  4. 不用电感器，体积小，重量轻，在低频情况下，这种优点更为突出；
  5. 设计有源滤波器比设计 LC 滤波器更具灵活性，也可得到电压增益。

但应当注意，有源滤波器以集成运放作为有源元件，所以一定要电源，输入小信号时受运放带宽限制，输入大信号时受运放压摆率的限制，这就决定了有源滤波器不适用于高频范围。

### 主要区别
  * 工作原理。无源滤波器由 LC 等元件组成，将其设计为某频率下极低阻抗，对相应频率谐波电流进行分流，其行为模式为提供被动式谐波电流旁路通道。有源滤波器由电力电子元件和 DSP 等构成的电能变换设备，检测负载谐波电流并主动提供对应的补偿电流，补偿后的源电流几乎为纯正弦波，其行为模式为主动式电流源输出；
  * 谐波处理能力。无源滤波器只能滤除某个特定阶次的谐波，有源滤波器可动态滤除各次谐波；
  * 频率变化的影响。无源滤波器谐振点偏移，效果降低；有源滤波器不受影响；
  * 系统阻抗变化影响。无源滤波器受系统阻抗影响严重，存在谐波放大和共振的危险，而有源滤波不受影响。
  * 负载变化对谐波补偿效果的影响。无源滤波器补偿效果随着负载的变化而变化，有源滤波器不受负载变化影响；
  * 负载增加的影响。无源滤波器可能因为超载而损坏，有源滤波器无损坏之危险，谐波量大于补偿能力时，仅发生补偿效果不足而已；
  * 设备造价。无源滤波器造价较低，有源滤波器造价高。

## 基于对 LC 梯形网络工作模拟的有源 RC 滤波器的设计法
基于对 LC 梯形网络工作模拟的设计方法是利用有源 RC 网络去模拟 LC 梯形网络的内部工作关系（也即**数学方程**），从而实现有源 RC 滤波器的一种设计方法。这种方法也称为**运算模拟法**。其中，被用来模拟的满足滤波要求的 LC 梯形网络称为原型 LC 梯形网络。LC 梯形网络的内部工作关系主要是指**元件的伏安关系**和**电路拓扑中的电压电流关系**。

在 LC 梯形网络中，电感元件和电容元件的电压电流 $vi$ 关系是积分和微分的关系，这些关系可以利用含有积分器的有源 RC 电路来模拟实现。同时，根据基尔霍夫电压定律和基尔霍夫电流定律描述的 LC 梯形网络的回路电压关系和节点电流关系也可以用有源电路纽成的相加器来模拟实现。

因此，用基于对 LC 梯形网络工作模拟的方法设计出来的滤波器是由**有源积分器**和**相加器**组成的有源 RC 滤波器。

## 具有全极点的高阶有源 RC 低通滤波器设计
某些低通滤波器的转移函数具有以下形式：
$$H(s)=\frac{Constant}{s^{x}}, x\in N^{+} \tag{3.1.1}$$
这说明转移函数在有限频率下没有零点，而只有极点，实现这类转移函数的滤波器就称**全极点滤波器**。

*零极点的物理含义：当系统输入幅度不为零且输入频率使系统输出为零时，此输入频率值即为零点；当系统输入幅度不为零且输入频率使系统输出为无穷大（系统稳定破坏，发生振荡）时，此频率值即为极点。*

实际上，使用 Butterworth（巴特沃斯）和 Chebyshev（切比雪夫）逼近的滤波器转移函数具有上述的转移函数特性。**Butterworth** 低通滤波器转移函数如下述所示：
$$H(s)=\frac{H_0}{D(s)}=\frac{H_0}{b_0+b_1s+b_2s^2+b_3s^3+...+b_{n-1}s^{n-1}+s^n} \tag{3.1.2}$$
其中 $H_0=H(0)$ 表示在 $\omega=0$ 处取得的值。 

**Chebyshev** 低通滤波器转移函数如下述所示：
$$H(s)=\frac{1}{D(s)}=\frac{1}{b_0+b_1s+b_2s^2+b_3s^3+...+b_{n-1}s^{n-1}+s^n} \tag{3.1.3}$$

<br>下面给出一个双端接电阻的五阶 LC 梯形全极点低通无源滤波器设计案例，并展示如何将其利用**运算模拟法**转换为有源滤波器设计。

*注意：小写字母将表示原型无源 LC 网络的各器件值，大写字母将表示利用运算模拟法得到的有源 RC 网络的各器件值。*

<div align='center'><img src='../Picture/LPF/屏幕截图 2022-11-24 190054.png' alt="一个双端接电阻的五阶 LC 梯形全极点低通无源滤波器设计案例" title="双端接电阻的五阶 LC 梯形全极点低通无源滤波器" /></div>

### 工作方程
为了描述工作状态，应该选取电容电压和电感电流作为 LC 梯形网络的变量，列写**每个**电抗元件的工作方程。

  * *注意：所列写的工作方程变量必须只含电容电压、电感电流或输入电压（或电流）。*
  * 电容的复阻抗为 $\frac{1}{s_c}$ ，电感的复阻抗为 $sl$ 。

对于电容 $c_1$ 有：
$$v_1(s)=\frac{i_1(s)}{sc_1} \tag{3.2.1}$$
可以发现， $i_1(s)$ 是一个多余的变量。如何消去？通过**节点方程**或**回路方程**消去。

为了便于列写回路方程，将电路转换为**以电流源驱动**的系统。显然， $v_i(s)$ 与 $r_s$ 串联构成的电压源模型可转换为 $\frac{v_i(s)}{r_s}$ 和 $r_s$ 并联的模型。

<div align='center'><img src='../Picture/LPF/屏幕截图 2022-11-24 185941.jpg' /></div>

由图中可以得到， $i_1(s)$ 列写为：
$$i_1(s)=\frac{v_i(s)}{r_s}-i_s(s)-i_2(s)=\frac{v_i(s)}{r_s}-\frac{v_1(s)}{r_s}-i_2(s) \tag{3.2.2}$$

将 $i_1(s)$ 代入上述关于 $c_1$ 的式 $(3.2.1)$ 中得到
$$v_1(s)=\frac{\frac{v_i(s)}{r_s}-i_2(s)}{sc_1+\frac{1}{r_s}} \tag{3.2.3}$$

<div align='center'><img src='../Picture/LPF/屏幕截图 2022-11-26 171810.png' /></div>

对于电感 $l_2$ 有 
$$i_2(s)=\frac{v_2(s)}{sl_2} \tag{3.2.4}$$

而 $v_2(s)$ 是一个多余的变量，可以利用回路方程消去：
$$v_2(s)=v_1(s)-v_3(s) \tag{3.2.5}$$

则关于电感 $l_2$ 的式 $(3.2.4)$ 可变为
$$i_2(s)=\frac{v_1(s)-v_3(s)}{sl_2} \tag{3.2.6}$$

关于器件 $c_3$ 、 $l_4$ 和 $c_5$ 的工作方程也可以轻易列出：
$$v_3(s)=\frac{i_2(s)-i_4(s)}{sc_3} \tag{3.2.7}$$
$$i_4(s)=\frac{v_3(s)-v_5(s)}{sl_4} \tag{3.2.8}$$
$$v_5(s)=\frac{i_4(s)}{sc_5+\frac{1}{r_l}} \tag{3.2.9}$$

$v_1(s)$ 、 $i_2(s)$ 、 $v_3(s)$ 、 $i_4(s)$ 和 $v_5(s)$ 组成的方程组完整描述了上述 LC 网络的工作方式，目的是为了模拟有源 RC 积分器与加法器的工作方式。

### 运算框图
根据上述方程组，可画出运算框图，其要点包括下述几项：
  * 每个积分器代表一个元器件的工作方程，一般 n 阶 LC 梯型网络的框图有 n 个积分器；
  * 用来模拟电容工作的积分器输出端朝下（后），用来模拟电感工作的积分器输出端朝上（前），宏观来看各个积分器的输出端朝向应该是**上下交替**的；
  * 如果**端接电阻**，积分器应该是阻尼积分器，也即分母多了 $\frac{1}{r_s}$ 和（或） $\frac{1}{r_l}$ 项；
  * 在用有源电路实现积分器时，反相积分器应该被更多地使用，这是因为反相积分器的设计相对简单。

<div align='center'><img src='..\Picture\LPF\屏幕截图 2022-11-26 181214.png' alt='该全极点滤波器设计案例中的运算框图' title='双端接电阻的五阶 LC 梯形全极点低通滤波器运算框图' /></div>

<br>在该框图中，积分器均为同相积分器，因此需要调整工作方程，以匹配反相积分器设计。把式子的电流（电压）分量与积分器分量分开，调整后的方程如下：
$$-v_1(s)=\frac{-1}{sc_1+\frac{1}{r_s}} \left [ \frac{v_i(s)}{r_s}-i_2(s) \right ] \tag{3.3.1}$$
$$-i_2(s)=\frac{1}{sl_2}[-v_1(s)+v_2(s)] \tag{3.3.2}$$
$$v_3(s)=\frac{-1}{sc_3}[-i_2(s)+i_4(s)] \tag{3.3.3}$$
$$i_4(s)=\frac{1}{sl_4}[v_3(s)-v_5(s)] \tag{3.3.4}$$
$$-v_5(s)=\frac{-1}{sc_5+\frac{1}{r_1}}i_4(s) \tag{3.3.5}$$

其中，负号的项就意味着使用反相积分器设计，调整后运算框图应该是这样：
<div align='center'><img src='../Picture/LPF/屏幕截图 2022-11-26 201347.png' /></div>

### 实现电路
上述运算框图包含**反相积分器**、**反相阻尼积分器**、**同相积分器**和**加法器**。

#### 反相积分器
假设是理想情况，反相积分器的转移函数为
$$H(s)=\frac{v_o(s)}{v_i(s)}=-\frac{1}{sCR} \tag{3.4.1}$$
其有源 RC 网络实现电路长这样：
<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-27 144415.png' height='200' alt='反相积分器的有源 RC 网络' title='有源 RC 反相积分器实现电路'></div>

#### 反相阻尼积分器（反相有损积分器）
假设是理想情况，反相阻尼积分器的转移函数为：
$$H(s)=\frac{v_o(s)}{v_i(s)}=-\frac{\frac{1}{R_1C}}{s+\frac{1}{R_2C}} \tag{3.4.2}$$
其有源 RC 网络实现电路长这样：
<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-27 172713.png' height='200' alt='反相阻尼积分器的有源 RC 网络' title='有源 RC 反相阻尼积分器实现电路'></div>

#### 同相积分器
假设是理想情况，同相积分器的转移函数为：
$$H(s)=\frac{v_o(s)}{v_i(s)}=\frac{1}{sCR} \tag{3.4.3}$$
同相积分器的有源 RC 网络实现电路是**反相积分器级联一个反相放大器**构成的。
<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-27 173131.png' height='200' alt='反相阻尼积分器的有源 RC 网络' title='有源 RC 反相阻尼积分器实现电路'></div>

#### 整体电路的实现
理想情况下积分器的运算放大器均虚地，因此直接在积分器的运算放大器虚地处接两个输入端就可以实现信号的求和，这样可省去加法器。

<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-27 174824.png' height='' alt='上述无源滤波器运算模拟后的有源 RC 滤波器电路' title='无源滤波器运算模拟后的有源 RC 滤波器电路'></div>

### 确定元件参数
假设为理想情况，上述有源 RC 滤波器对应无源 LC 滤波器工作方程的关系满足下述式子：
$$V_1(s)=-\frac{G_{1i}V_i(s)+G_{12}V_2(s)}{sC_{11}+G_{11}} \Leftrightarrow v_1(s)=\frac{\frac{v_i(s)}{r_s}-i_2(s)}{sc_1+\frac{1}{r_s}} \tag{3.5.1}$$
$$V_2(s)=\frac{G_{21}V_1(s)+G_{23}V_3(s)}{sC_{22}} \Leftrightarrow i_2(s)=\frac{v_1(s)-v_3(s)}{sl_2} \tag{3.5.2}$$
$$V_3(s)=-\frac{G_{32}V_2(s)+G_{34}V_4(s)}{sC_{33}} \Leftrightarrow v_3(s)=\frac{i_2(s)-i_4(s)}{sc_3} \tag{3.5.3}$$
$$V_4(s)=\frac{G_{43}V_3(s)+G_{45}V_5(s)}{sC_{44}} \Leftrightarrow i_4(s)=\frac{v_3(s)-v_5(s)}{sl_4} \tag{3.5.4}$$
$$V_5(s)=-\frac{G_{54}V_4(s)}{sC_{55}+G_{55}} \Leftrightarrow v_5(s)=\frac{i_4(s)}{sc_5+\frac{1}{r_l}} \tag{3.5.5}$$

所以，化简上式后 $V(s)$ 与 $v(s)$ 的对应关系为：
$$V_i(s) \Leftrightarrow v_i(s),\\ V_1(s) \Leftrightarrow -v_1(s),\\ V_2(s) \Leftrightarrow -i_2(s),$$
$$V_3(s) \Leftrightarrow v_3(s),\\ V_4(s) \Leftrightarrow i_4(s),\\ V_5(s) \Leftrightarrow -v_5(s)$$

各元器件的值由下式确定：
$$\begin{cases}
  & G_{1i}=\frac{1}{r_s}  & G_{12}=1  & C_{11}=c_1  & G_{11}=\frac{1}{r_s}\\\
  & G_{21}=1  & G_{23}=1  & C_{22}=l_2  & G_{32}=1\\\
  & G_{34}=1  & C_{33}=c_3  & G_{43}=1  & G_{45}=1\\\
  & C_{44}=l_4  & G_{54}=1  & C_{55}=c_5  & G_{55}=\frac{1}{r_1}
\end{cases} \tag{3.5.6}$$

*注意：上述元件值不是唯一的，理论值可能存在问题，应视实际情况进行调整。*

### 根据实际要求进行频率和阻抗去归一化
假设给出某一全极点的无源滤波器性能要求为：截止频率 $f_p$ ，端接电阻有 $r_s=r_1$ 。
#### 频率去归一化
有参数 $f_p$ ，则 $\omega_{p}=2\pi f_p$ ，频率去归一化的变换式为 $p=\frac{s}{\omega_p}$ 。

  * 对 $l(H)$ 的电感应变换为 $\frac{1}{\omega_p(H)}$ ;
  * 对 $c(F)$ 的电容应变换为 $\frac{1}{\omega_p(F)}$ 。

#### 阻抗去归一化
所有的电阻和电感乘以端接电阻的数值，所有的电感都除以端接电阻的数值，可实现阻抗归一化。

完成对电阻、电感、电容的乘除法操作后，重新得到基于运算模拟法的无源到有源滤波器的转换。

## 具有有限传输零点的高阶有源 RC 低通滤波器设计
有些滤波器系统转移函数的分子上不是常数，可能会存在有限传输零点。例如 Cauer 函数设计实现的椭圆低通滤波器转移函数可以表达为：
$$H(s)=\frac{k \prod_{i=1}^{m}(s^2+a_i)}{b_0+b_1s+b_2s^2+b_3s^3+...+b_{n-1}s^{n-1}+s^n} \tag{4.1.1}$$
它就可能存在有限传输零点。

下面给出一个具有**两个有限传输零点**的五阶低通滤波器的 LC 梯形滤波器设计案例，并展示如何利用运算模拟法将其转化为有源滤波器设计。

<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-27 184516.png' alt='具有两个有限传输零点的五阶 LC 梯形低通滤波器' title='具有两个有限传输零点的五阶 LC 梯形低通滤波器' /></div>

比较全极点低通滤波器，可以发现它们的区别在于两个并联电容 $c_2$ 和 $c_4$ ，它们分别与电感 $l_2$ 和 $l_4$ 并联。可以通过消去并联电容以使用前述的方法设计有源 RC 滤波器。

### 消去并联电容
电容 $c_2$ 的一端接电压 $v_1(s)$ ，另一端接电压 $v_3(s)$ ，可以这样等效：**将电容 $c_2$ 与受控电压源 $v_3(s)$ 串联，同时该串联支路与电容 $c_1$ 并联；将另一个 $c_2$ 与受控电压源 $v_1(s)$ 串联，同时该串联支路与电容 $c_3$ 并联。**

电容 $c_4$ 也根据上述的方式和受控电压源等效电路，最后得到下图。

<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-28 141814.png' alt='' title='消去并联电容的等效电路' /></div>

其中，电阻 $r_s$ 与输入电压源 $v_i(s)$ 变为并联形式，即输入电流源 $\frac{v_i(s)}{r_s}$ 与电阻 $r_s$ 并联。

再将各受控电压源与串联电容等效为**受控电流源与并联电容**，这样可以将电容数量减少。
$$\begin{cases}
  c_1^{'}=c_1+c_2 \\\
  c_3^{'}=c_2+c_3+c_4 \\\
  c_5^{'}=c_4+c_5
\end{cases} \tag{4.2.1}$$

等效后电路图变为这样：
<div align='center'><img src='../Picture\LPF\屏幕截图 2022-11-28 150928.png' alt='' title='消去并联电容的等效电路' /></div>

<br>与全极点的电路比较，区别在于三个分流电容 $c_1^{'}$ 、 $c_3^{'}$ 和 $c_5^{'}$ 处并联了受控电流源，这四个受控电流源使得滤波器存在有限传输零点。

### 工作方程
由于
$$i_1(s)=\frac{v_i(s)}{r_s}-i_s(s)-i_2(s)+sc_2v_3(s) \\\ =\frac{v_i(s)}{r_s}-\frac{v_1(s)}{r_s}-i_2(s)+sc_2v_3(s) \tag{4.3.1}$$
所以
$$v_1(s)=\frac{\frac{v_i(s)}{r_s}-i_2(s)+sc_2v_3(s)}{sc_1^{'}+\frac{1}{r_s}} \tag{4.3.2}$$
其余的 4 个器件工作方程也可以利用节点方程轻易得：
$$i_2(s)=\frac{v_1(s)-v_3(s)}{sl_2} \tag{4.3.3}$$
$$v_3(s)=\frac{i_2(s)-i_4(s)+sc_2v_1(s)+sc_4v_5(s)}{sc_3^{'}} \tag{4.3.4}$$
$$i_4(s)=\frac{v_3(s)-v_5(s)}{sl_4} \tag{4.3.5}$$
$$v_5(s)=\frac{i_4(s)+sc_4v_3(s)}{sc_5^{'}+\frac{1}{r_1}} \tag{4.3.6}$$

### 实现电路
